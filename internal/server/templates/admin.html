{{define "content"}}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Admin Panel</h1>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-4 border-danger">
            <div class="card-header bg-danger text-white">Danger Zone: Reset Database</div>
            <div class="card-body">
                <p class="card-text">This will <strong class="text-danger">DELETE ALL DATA</strong> (Hosts, Scans,
                    Vulnerabilities). This action cannot be undone.</p>
                <form action="/admin/reset" method="post"
                    onsubmit="return confirm('Are you sure you want to WIPE ALL DATA?');">
                    <button type="submit" class="btn btn-danger">Reset Database</button>
                </form>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card mb-4 border-primary">
            <div class="card-header bg-primary text-white">Generate Sample Data</div>
            <div class="card-body">
                <p class="card-text">Generate mock scans and ingest them into the system. Useful for testing and demos.
                </p>
                <form action="/admin/generate" method="post">
                    <button type="submit" class="btn btn-primary">Generate & Ingest Samples</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card mb-4 border-success">
            <div class="card-header bg-success text-white">Upload Vulnerability Scan</div>
            <div class="card-body">
                <p class="card-text">Upload a <code>.nessus</code> XML file to ingest new vulnerability data.</p>
                <form action="/upload" method="post" enctype="multipart/form-data">
                    <div class="input-group">
                        <input class="form-control" type="file" id="scanfile" name="scanfile" required>
                        <button type="submit" class="btn btn-dark">Upload & Ingest</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card mb-4 border-info">
            <div class="card-header bg-info text-white">SLA Configuration (Days)</div>
            <div class="card-body">
                <form action="/admin/settings" method="post">
                    <div class="row g-3 align-items-center">
                        <div class="col-auto">
                            <label for="sla_Critical" class="col-form-label fw-bold text-danger">Critical:</label>
                        </div>
                        <div class="col-auto">
                            <input type="number" id="sla_Critical" name="sla_Critical" class="form-control"
                                style="width: 80px;" value="{{if .SLA.Critical}}{{.SLA.Critical}}{{else}}7{{end}}">
                        </div>

                        <div class="col-auto">
                            <label for="sla_High" class="col-form-label fw-bold text-warning">High:</label>
                        </div>
                        <div class="col-auto">
                            <input type="number" id="sla_High" name="sla_High" class="form-control" style="width: 80px;"
                                value="{{if .SLA.High}}{{.SLA.High}}{{else}}14{{end}}">
                        </div>

                        <div class="col-auto">
                            <label for="sla_Medium" class="col-form-label fw-bold text-info">Medium:</label>
                        </div>
                        <div class="col-auto">
                            <input type="number" id="sla_Medium" name="sla_Medium" class="form-control"
                                style="width: 80px;" value="{{if .SLA.Medium}}{{.SLA.Medium}}{{else}}30{{end}}">
                        </div>

                        <div class="col-auto">
                            <label for="sla_Low" class="col-form-label fw-bold text-primary">Low:</label>
                        </div>
                        <div class="col-auto">
                            <input type="number" id="sla_Low" name="sla_Low" class="form-control" style="width: 80px;"
                                value="{{if .SLA.Low}}{{.SLA.Low}}{{else}}60{{end}}">
                        </div>

                        <div class="col-auto">
                            <button type="submit" class="btn btn-info text-white">Save Settings</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-4 border-secondary">
            <div class="card-header bg-secondary text-white">Feature Toggles</div>
            <div class="card-body">
                <form action="/admin/settings" method="post">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="compliance_enabled" name="compliance_enabled" value="true" {{if .ComplianceEnabled}}checked{{end}}>
                        <label class="form-check-label" for="compliance_enabled">
                            <strong>Compliance Module</strong>
                            <br><small class="text-muted">Enable PCI-DSS, HIPAA, NIST, CIS compliance tracking</small>
                        </label>
                    </div>
                    <button type="submit" class="btn btn-secondary">Save Features</button>
                </form>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="alert alert-info" role="alert">
            <h4 class="alert-heading">Application Info</h4>
            <p>Vuln-Strix v0.1.0-alpha</p>
            <hr>
            <p class="mb-0">Running on localhost:8080</p>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card mb-4 border-warning">
            <div class="card-header bg-warning text-dark">
                <span data-feather="trash-2" class="me-2"></span>
                Clear Custom Data
            </div>
            <div class="card-body">
                <p class="card-text">Selectively clear custom data. Check the items you want to remove.</p>
                <form action="/admin/cleardata" method="post" onsubmit="return confirmClear()">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="clear_groups" name="clear_groups" value="true">
                                <label class="form-check-label" for="clear_groups">
                                    <strong>Asset Groups</strong>
                                    <br><small class="text-muted">Removes all custom groups and resets to defaults</small>
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="clear_settings" name="clear_settings" value="true">
                                <label class="form-check-label" for="clear_settings">
                                    <strong>Settings</strong>
                                    <br><small class="text-muted">Resets SLA and feature settings to defaults</small>
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="clear_audit" name="clear_audit" value="true">
                                <label class="form-check-label" for="clear_audit">
                                    <strong>Audit Log</strong>
                                    <br><small class="text-muted">Clears all audit log history</small>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="clear_filters" name="clear_filters" value="true">
                                <label class="form-check-label" for="clear_filters">
                                    <strong>Saved Filters</strong>
                                    <br><small class="text-muted">Removes all saved search filters</small>
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="clear_search_history" name="clear_search_history" value="true">
                                <label class="form-check-label" for="clear_search_history">
                                    <strong>Search History</strong>
                                    <br><small class="text-muted">Clears recent search history</small>
                                </label>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <button type="submit" class="btn btn-warning">
                        <span data-feather="trash-2" class="me-1"></span>
                        Clear Selected Data
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Initialize feather icons
    if (typeof feather !== 'undefined') {
        feather.replace();
    }

    // Confirm clear data
    function confirmClear() {
        const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
        if (checkboxes.length === 0) {
            alert('Please select at least one item to clear.');
            return false;
        }
        const items = Array.from(checkboxes).map(cb => cb.nextElementSibling.querySelector('strong').textContent);
        return confirm('Are you sure you want to clear the following data?\n\n- ' + items.join('\n- ') + '\n\nThis action cannot be undone.');
    }

    // Check for status query param to show alerts
    const urlParams = new URLSearchParams(window.location.search);
    const status = urlParams.get('status');
    if (status === 'reset_success') {
        alert('Database has been reset successfully.');
    } else if (status === 'generate_success') {
        alert('Sample data has been generated and ingested successfully.');
    } else if (status === 'clear_success') {
        alert('Selected data has been cleared successfully.');
    } else if (status === 'settings_saved') {
        alert('Settings have been saved successfully.');
    }
</script>
{{end}}