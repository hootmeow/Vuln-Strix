{{define "content"}}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Scan History</h1>
</div>

<div class="mb-3">
    <input type="text" id="scanSearch" class="form-control" placeholder="Search scans by Name or Policy..."
        onkeyup="filterScans()">
</div>

<div class="table-responsive">
    <table class="table table-striped table-sm" id="scansTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Scan Date</th>
                <th>Policy</th>
                <th>Hosts</th>
                <th>Stats (C/H/M/L)</th>
            </tr>
        </thead>
        <tbody>
            {{range .Scans}}
            <tr>
                <td>{{.Name}}</td>
                <td>{{.ScanStart.Format "2006-01-02 15:04"}} - {{.ScanEnd.Format "15:04"}}</td>
                <td>
                    {{.PolicyName}}<br>
                    <small class="text-muted">{{.PluginSet}}</small>
                </td>
                <!-- We don't have host count on Scan object directly yet, maybe add later or computed on ingest? 
                     Using raw stats for now -->
                <td>-</td>
                <td>
                    <span class="badge bg-danger">{{.CriticalCount}}</span>
                    <span class="badge bg-warning text-dark">{{.HighCount}}</span>
                    <span class="badge bg-warning">{{.MediumCount}}</span>
                    <span class="badge bg-info">{{.LowCount}}</span>
                </td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

<script>
    function filterScans() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("scanSearch");
        filter = input.value.toUpperCase();
        table = document.getElementById("scansTable");
        tr = table.getElementsByTagName("tr");
        for (i = 0; i < tr.length; i++) {
            // Check Name and Policy columns (Indices 0, 2)
            var found = false;
            // Name
            td = tr[i].getElementsByTagName("td")[0];
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) found = true;
            }
            // Policy
            td = tr[i].getElementsByTagName("td")[2];
            if (td && !found) {
                txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) found = true;
            }

            if (tr[i].getElementsByTagName("th").length > 0) continue;

            if (found) {
                tr[i].style.display = "";
            } else {
                tr[i].style.display = "none";
            }
        }
    }
</script>
{{end}}