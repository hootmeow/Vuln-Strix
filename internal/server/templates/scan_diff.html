{{define "content"}}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Scan Differential Analysis</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="/scans" class="btn btn-sm btn-outline-secondary">
            <span data-feather="arrow-left"></span> Back to Scans
        </a>
    </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card text-center border-danger">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">New Findings</h6>
                <h2 class="card-title text-danger">+{{.Stats.NewCount}}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center border-success">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Fixed Findings</h6>
                <h2 class="card-title text-success">-{{.Stats.FixedCount}}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center border-warning">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Regressed Findings</h6>
                <h2 class="card-title text-warning">{{.Stats.RegressedCount}}</h2>
            </div>
        </div>
    </div>
</div>

<!-- Tabs -->
<ul class="nav nav-tabs mb-3" id="diffTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="new-tab" data-bs-toggle="tab" data-bs-target="#new" type="button" role="tab"
            aria-controls="new" aria-selected="true">
            New Risks <span class="badge bg-danger ms-2">{{.Stats.NewCount}}</span>
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="fixed-tab" data-bs-toggle="tab" data-bs-target="#fixed" type="button" role="tab"
            aria-controls="fixed" aria-selected="false">
            Fixed <span class="badge bg-success ms-2">{{.Stats.FixedCount}}</span>
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="regressed-tab" data-bs-toggle="tab" data-bs-target="#regressed" type="button"
            role="tab" aria-controls="regressed" aria-selected="false">
            Regressed <span class="badge bg-warning text-dark ms-2">{{.Stats.RegressedCount}}</span>
        </button>
    </li>
</ul>

<div class="tab-content" id="diffTabsContent">
    <!-- New Findings -->
    <div class="tab-pane fade show active" id="new" role="tabpanel" aria-labelledby="new-tab">
        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th>Host</th>
                        <th>Vulnerability</th>
                        <th>Severity</th>
                        <th>Family</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .New}}
                    <tr>
                        <td><a href="/hosts/{{.HostID}}">{{.Host.Hostname}}</a><br><small
                                class="text-muted">{{.Host.IP}}</small></td>
                        <td>{{.Vuln.Name}}</td>
                        <td><span
                                class="badge bg-{{.Vuln.Severity}} severity-{{.Vuln.Severity}}">{{.Vuln.Severity}}</span>
                        </td>
                        <td>{{.Vuln.Family}}</td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Fixed Findings -->
    <div class="tab-pane fade" id="fixed" role="tabpanel" aria-labelledby="fixed-tab">
        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th>Host</th>
                        <th>Vulnerability</th>
                        <th>Severity</th>
                        <th>Fixed Date</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Fixed}}
                    <tr>
                        <td><a href="/hosts/{{.HostID}}">{{.Host.Hostname}}</a></td>
                        <td>{{.Vuln.Name}}</td>
                        <td><span
                                class="badge bg-{{.Vuln.Severity}} severity-{{.Vuln.Severity}}">{{.Vuln.Severity}}</span>
                        </td>
                        <td>{{.FixedAt.Format "2006-01-02"}}</td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Regressed Findings -->
    <div class="tab-pane fade" id="regressed" role="tabpanel" aria-labelledby="regressed-tab">
        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th>Host</th>
                        <th>Vulnerability</th>
                        <th>Reopen Count</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Regressed}}
                    <tr>
                        <td><a href="/hosts/{{.HostID}}">{{.Host.Hostname}}</a></td>
                        <td>{{.Vuln.Name}}</td>
                        <td class="text-danger fw-bold">{{.ReopenCount}}</td>
                        <td>{{.Status}}</td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
    </div>
</div>
{{end}}